{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/app/api/settings/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { PrismaClient } from '@prisma/client'\n\nconst prisma = new PrismaClient()\n\nasync function ensureTable() {\n  await prisma.$executeRawUnsafe(`\n    CREATE TABLE IF NOT EXISTS church_settings (\n      id TEXT PRIMARY KEY DEFAULT 'main',\n      active_members INTEGER DEFAULT 0,\n      ministry_partnerships INTEGER DEFAULT 0,\n      updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n    )\n  `)\n  // Initialize with default values if no record exists\n  const exists = await prisma.$queryRaw`SELECT id FROM church_settings WHERE id = 'main' LIMIT 1`\n  if (!Array.isArray(exists) || exists.length === 0) {\n    await prisma.$executeRaw`INSERT INTO church_settings (id, active_members, ministry_partnerships) VALUES ('main', 2000, 50)`\n  }\n}\n\nexport async function GET() {\n  try {\n    await ensureTable()\n    const rows: any[] = await prisma.$queryRaw`SELECT active_members as \"activeMembers\", ministry_partnerships as \"ministryPartnerships\" FROM church_settings WHERE id = 'main' LIMIT 1`\n    const settings = rows && rows.length ? rows[0] : { activeMembers: 2000, ministryPartnerships: 50 }\n    \n    // Calculate years serving from Feb 7, 2020\n    const foundingDate = new Date('2020-02-07')\n    const now = new Date()\n    const yearsServing = Math.floor((now.getTime() - foundingDate.getTime()) / (1000 * 60 * 60 * 24 * 365.25))\n    \n    return NextResponse.json({ \n      settings,\n      yearsServing \n    })\n  } catch (e) {\n    console.error(e)\n    return NextResponse.json({ error: 'Failed to fetch settings' }, { status: 500 })\n  }\n}\n\nexport async function PATCH(req: Request) {\n  try {\n    const body = await req.json()\n    const { activeMembers, ministryPartnerships } = body || {}\n    \n    await ensureTable()\n    \n    if (activeMembers !== undefined) {\n      await prisma.$executeRaw`UPDATE church_settings SET active_members = ${Number(activeMembers)}, updated_at = NOW() WHERE id = 'main'`\n    }\n    \n    if (ministryPartnerships !== undefined) {\n      await prisma.$executeRaw`UPDATE church_settings SET ministry_partnerships = ${Number(ministryPartnerships)}, updated_at = NOW() WHERE id = 'main'`\n    }\n    \n    return NextResponse.json({ ok: true })\n  } catch (e) {\n    console.error(e)\n    return NextResponse.json({ error: 'Failed to update settings' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAE/B,eAAe;IACb,MAAM,OAAO,iBAAiB,CAAC,CAAC;;;;;;;EAOhC,CAAC;IACD,qDAAqD;IACrD,MAAM,SAAS,MAAM,OAAO,SAAS,CAAC,wDAAwD,CAAC;IAC/F,IAAI,CAAC,MAAM,OAAO,CAAC,WAAW,OAAO,MAAM,KAAK,GAAG;QACjD,MAAM,OAAO,WAAW,CAAC,iGAAiG,CAAC;IAC7H;AACF;AAEO,eAAe;IACpB,IAAI;QACF,MAAM;QACN,MAAM,OAAc,MAAM,OAAO,SAAS,CAAC,wIAAwI,CAAC;QACpL,MAAM,WAAW,QAAQ,KAAK,MAAM,GAAG,IAAI,CAAC,EAAE,GAAG;YAAE,eAAe;YAAM,sBAAsB;QAAG;QAEjG,2CAA2C;QAC3C,MAAM,eAAe,IAAI,KAAK;QAC9B,MAAM,MAAM,IAAI;QAChB,MAAM,eAAe,KAAK,KAAK,CAAC,CAAC,IAAI,OAAO,KAAK,aAAa,OAAO,EAAE,IAAI,CAAC,OAAO,KAAK,KAAK,KAAK,MAAM;QAExG,OAAO,uRAAY,CAAC,IAAI,CAAC;YACvB;YACA;QACF;IACF,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC;QACd,OAAO,uRAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;IAChF;AACF;AAEO,eAAe,MAAM,GAAY;IACtC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,aAAa,EAAE,oBAAoB,EAAE,GAAG,QAAQ,CAAC;QAEzD,MAAM;QAEN,IAAI,kBAAkB,WAAW;YAC/B,MAAM,OAAO,WAAW,CAAC,4CAA4C,EAAE,OAAO,eAAe,sCAAsC,CAAC;QACtI;QAEA,IAAI,yBAAyB,WAAW;YACtC,MAAM,OAAO,WAAW,CAAC,mDAAmD,EAAE,OAAO,sBAAsB,sCAAsC,CAAC;QACpJ;QAEA,OAAO,uRAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC;QACd,OAAO,uRAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;IACjF;AACF","debugId":null}}]
}