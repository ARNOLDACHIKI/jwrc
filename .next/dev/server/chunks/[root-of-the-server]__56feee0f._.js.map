{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { __prisma?: PrismaClient }\n\nconst prisma = globalForPrisma.__prisma ?? new PrismaClient()\nif (process.env.NODE_ENV !== 'production') globalForPrisma.__prisma = prisma\n\nexport async function safeExecute(sql: string, ...params: any[]) {\n  try {\n    return await prisma.$executeRawUnsafe(sql, ...params)\n  } catch (err: any) {\n    console.warn('DB execute failed:', err?.message || err)\n    return null\n  }\n}\n\nexport async function safeQuery<T = any>(sql: string, ...params: any[]): Promise<T[]> {\n  try {\n    const rows = await prisma.$queryRawUnsafe(sql, ...params)\n    return Array.isArray(rows) ? (rows as T[]) : (rows ? [rows as T] : [])\n  } catch (err: any) {\n    console.warn('DB query failed:', err?.message || err)\n    return []\n  }\n}\n\nexport { prisma }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM;AAEN,MAAM,SAAS,gBAAgB,QAAQ,IAAI,IAAI,6IAAY;AAC3D,wCAA2C,gBAAgB,QAAQ,GAAG;AAE/D,eAAe,YAAY,GAAW,EAAE,GAAG,MAAa;IAC7D,IAAI;QACF,OAAO,MAAM,OAAO,iBAAiB,CAAC,QAAQ;IAChD,EAAE,OAAO,KAAU;QACjB,QAAQ,IAAI,CAAC,sBAAsB,KAAK,WAAW;QACnD,OAAO;IACT;AACF;AAEO,eAAe,UAAmB,GAAW,EAAE,GAAG,MAAa;IACpE,IAAI;QACF,MAAM,OAAO,MAAM,OAAO,eAAe,CAAC,QAAQ;QAClD,OAAO,MAAM,OAAO,CAAC,QAAS,OAAgB,OAAO;YAAC;SAAU,GAAG,EAAE;IACvE,EAAE,OAAO,KAAU;QACjB,QAAQ,IAAI,CAAC,oBAAoB,KAAK,WAAW;QACjD,OAAO,EAAE;IACX;AACF","debugId":null}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/app/api/auth/password-reset/confirm/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { prisma, safeExecute, safeQuery } from '@/lib/db'\nimport bcrypt from \"bcryptjs\"\n\nasync function ensureTable() {\n  await safeExecute(`\n    CREATE TABLE IF NOT EXISTS password_reset_tokens (\n      id TEXT PRIMARY KEY,\n      user_id TEXT NOT NULL,\n      token TEXT NOT NULL,\n      expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n      used BOOLEAN DEFAULT false,\n      created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),\n      used_at TIMESTAMP WITH TIME ZONE\n    )\n  `)\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json()\n    const { token, password } = body || {}\n    if (!token || !password) return NextResponse.json({ error: 'Token and password required' }, { status: 400 })\n\n    await ensureTable()\n    const rows: any[] = await safeQuery(`SELECT id, user_id, token, expires_at, used FROM password_reset_tokens WHERE token = $1 LIMIT 1`, String(token))\n    const row = rows && rows.length ? rows[0] : null\n    if (!row) return NextResponse.json({ error: 'Invalid or expired token' }, { status: 400 })\n    if (row.used) return NextResponse.json({ error: 'Token already used' }, { status: 400 })\n    if (new Date(row.expires_at) < new Date()) return NextResponse.json({ error: 'Token expired' }, { status: 400 })\n\n    const hash = await bcrypt.hash(String(password), 12)\n    await safeExecute(`UPDATE \"User\" SET password = $1 WHERE id = $2`, hash, row.user_id)\n    await safeExecute(`UPDATE password_reset_tokens SET used = true, used_at = NOW() WHERE id = $1`, row.id)\n\n    return NextResponse.json({ ok: true })\n  } catch (e) {\n    console.error(e)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEA,eAAe;IACb,MAAM,IAAA,0HAAW,EAAC,CAAC;;;;;;;;;;EAUnB,CAAC;AACH;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,MAAM,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,QAAQ,CAAC;QACrC,IAAI,CAAC,SAAS,CAAC,UAAU,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA8B,GAAG;YAAE,QAAQ;QAAI;QAE1G,MAAM;QACN,MAAM,OAAc,MAAM,IAAA,wHAAS,EAAC,CAAC,+FAA+F,CAAC,EAAE,OAAO;QAC9I,MAAM,MAAM,QAAQ,KAAK,MAAM,GAAG,IAAI,CAAC,EAAE,GAAG;QAC5C,IAAI,CAAC,KAAK,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;QACxF,IAAI,IAAI,IAAI,EAAE,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;QACtF,IAAI,IAAI,KAAK,IAAI,UAAU,IAAI,IAAI,QAAQ,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;QAE9G,MAAM,OAAO,MAAM,mMAAM,CAAC,IAAI,CAAC,OAAO,WAAW;QACjD,MAAM,IAAA,0HAAW,EAAC,CAAC,6CAA6C,CAAC,EAAE,MAAM,IAAI,OAAO;QACpF,MAAM,IAAA,0HAAW,EAAC,CAAC,2EAA2E,CAAC,EAAE,IAAI,EAAE;QAEvG,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK;IACtC,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC;QACd,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF","debugId":null}}]
}