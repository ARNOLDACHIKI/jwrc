{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/lib/db.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\n\nconst globalForPrisma = global as unknown as { __prisma?: PrismaClient }\n\nconst prisma = globalForPrisma.__prisma ?? new PrismaClient()\nif (process.env.NODE_ENV !== 'production') globalForPrisma.__prisma = prisma\n\nexport async function safeExecute(sql: string, ...params: any[]) {\n  try {\n    return await prisma.$executeRawUnsafe(sql, ...params)\n  } catch (err: any) {\n    console.warn('DB execute failed:', err?.message || err)\n    return null\n  }\n}\n\nexport async function safeQuery<T = any>(sql: string, ...params: any[]): Promise<T[]> {\n  try {\n    const rows = await prisma.$queryRawUnsafe(sql, ...params)\n    return Array.isArray(rows) ? (rows as T[]) : (rows ? [rows as T] : [])\n  } catch (err: any) {\n    console.warn('DB query failed:', err?.message || err)\n    return []\n  }\n}\n\nexport { prisma }\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEA,MAAM;AAEN,MAAM,SAAS,gBAAgB,QAAQ,IAAI,IAAI,6IAAY;AAC3D,wCAA2C,gBAAgB,QAAQ,GAAG;AAE/D,eAAe,YAAY,GAAW,EAAE,GAAG,MAAa;IAC7D,IAAI;QACF,OAAO,MAAM,OAAO,iBAAiB,CAAC,QAAQ;IAChD,EAAE,OAAO,KAAU;QACjB,QAAQ,IAAI,CAAC,sBAAsB,KAAK,WAAW;QACnD,OAAO;IACT;AACF;AAEO,eAAe,UAAmB,GAAW,EAAE,GAAG,MAAa;IACpE,IAAI;QACF,MAAM,OAAO,MAAM,OAAO,eAAe,CAAC,QAAQ;QAClD,OAAO,MAAM,OAAO,CAAC,QAAS,OAAgB,OAAO;YAAC;SAAU,GAAG,EAAE;IACvE,EAAE,OAAO,KAAU;QACjB,QAAQ,IAAI,CAAC,oBAAoB,KAAK,WAAW;QACjD,OAAO,EAAE;IACX;AACF","debugId":null}},
    {"offset": {"line": 113, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/app/api/announcements/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { prisma } from '@/lib/db'\nimport jwt from \"jsonwebtoken\"\n\nfunction getTokenFromHeaders(req: Request) {\n  const cookie = req.headers.get(\"cookie\") || \"\"\n  const match = cookie.split(\";\").map((c) => c.trim()).find((c) => c.startsWith(\"token=\"))\n  if (!match) return null\n  return match.split(\"=\")[1]\n}\n\nexport async function GET() {\n  try {\n    const items = await prisma.announcement.findMany({ orderBy: { postedAt: 'desc' } })\n    return NextResponse.json({ announcements: items })\n  } catch (err) {\n    return NextResponse.json({ error: 'Failed to fetch announcements' }, { status: 500 })\n  }\n}\n\nexport async function POST(req: Request) {\n  try {\n    // check admin\n    const token = getTokenFromHeaders(req)\n    const secret = process.env.JWT_SECRET || 'dev-secret'\n    if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    let payload: any = null\n    try {\n      payload = jwt.verify(token, secret)\n    } catch (e) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n    if (payload.role !== 'admin') return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n\n    const body = await req.json()\n    const { title, content } = body\n    if (!title || !content) return NextResponse.json({ error: 'Missing fields' }, { status: 400 })\n\n    const created = await prisma.announcement.create({ data: { title, content, author: payload.email } })\n    return NextResponse.json({ announcement: created }, { status: 201 })\n  } catch (err) {\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n\nexport async function DELETE(req: Request) {\n  try {\n    const token = getTokenFromHeaders(req)\n    const secret = process.env.JWT_SECRET || 'dev-secret'\n    if (!token) return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    let payload: any = null\n    try {\n      payload = jwt.verify(token, secret)\n    } catch (e) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n    if (payload.role !== 'admin') return NextResponse.json({ error: 'Forbidden' }, { status: 403 })\n\n    const body = await req.json()\n    const { id } = body || {}\n    if (!id) return NextResponse.json({ error: 'Missing id' }, { status: 400 })\n\n    try {\n      const deleted = await prisma.announcement.delete({ where: { id } })\n      return NextResponse.json({ deleted })\n    } catch (e: any) {\n      if (e.code === 'P2025') {\n        return NextResponse.json({ error: 'Not found' }, { status: 404 })\n      }\n      return NextResponse.json({ error: 'Failed to delete' }, { status: 500 })\n    }\n  } catch (err) {\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}