{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/lib/verification.ts"],"sourcesContent":["/**\n * Utility functions for email verification code generation and management\n */\n\n/**\n * Generates a random 6-digit verification code\n */\nexport function generateVerificationCode(): string {\n  return Math.floor(100000 + Math.random() * 900000).toString()\n}\n\n/**\n * Calculates the expiration time for a verification code (30 minutes from now)\n */\nexport function getVerificationCodeExpiration(): Date {\n  const expirationTime = new Date()\n  expirationTime.setMinutes(expirationTime.getMinutes() + 30)\n  return expirationTime\n}\n\n/**\n * Checks if a verification code has expired\n */\nexport function isVerificationCodeExpired(expiresAt: Date | null): boolean {\n  if (!expiresAt) return true\n  return new Date() > expiresAt\n}\n\n/**\n * Validates a verification code\n */\nexport function validateVerificationCode(\n  providedCode: string,\n  storedCode: string | null,\n  expiresAt: Date | null\n): { valid: boolean; message: string } {\n  if (!storedCode) {\n    return { valid: false, message: 'No verification code found' }\n  }\n\n  if (isVerificationCodeExpired(expiresAt)) {\n    return { valid: false, message: 'Verification code has expired' }\n  }\n\n  if (providedCode !== storedCode) {\n    return { valid: false, message: 'Invalid verification code' }\n  }\n\n  return { valid: true, message: 'Verification successful' }\n}\n"],"names":[],"mappings":"AAAA;;CAEC,GAED;;CAEC;;;;;;;;;;AACM,SAAS;IACd,OAAO,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;AAC7D;AAKO,SAAS;IACd,MAAM,iBAAiB,IAAI;IAC3B,eAAe,UAAU,CAAC,eAAe,UAAU,KAAK;IACxD,OAAO;AACT;AAKO,SAAS,0BAA0B,SAAsB;IAC9D,IAAI,CAAC,WAAW,OAAO;IACvB,OAAO,IAAI,SAAS;AACtB;AAKO,SAAS,yBACd,YAAoB,EACpB,UAAyB,EACzB,SAAsB;IAEtB,IAAI,CAAC,YAAY;QACf,OAAO;YAAE,OAAO;YAAO,SAAS;QAA6B;IAC/D;IAEA,IAAI,0BAA0B,YAAY;QACxC,OAAO;YAAE,OAAO;YAAO,SAAS;QAAgC;IAClE;IAEA,IAAI,iBAAiB,YAAY;QAC/B,OAAO;YAAE,OAAO;YAAO,SAAS;QAA4B;IAC9D;IAEA,OAAO;QAAE,OAAO;QAAM,SAAS;IAA0B;AAC3D","debugId":null}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/app/api/auth/verify-email/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { PrismaClient } from \"@prisma/client\"\nimport { validateVerificationCode } from \"@/lib/verification\"\nimport jwt from \"jsonwebtoken\"\n\nconst prisma = new PrismaClient()\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json()\n    const { email, verificationCode } = body || {}\n\n    if (!email || !verificationCode) {\n      return NextResponse.json(\n        { error: 'Email and verification code are required' },\n        { status: 400 }\n      )\n    }\n\n    // Find user by email\n    const user = await prisma.user.findUnique({\n      where: { email: String(email).toLowerCase() },\n    })\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'User not found' },\n        { status: 404 }\n      )\n    }\n\n    // Validate verification code\n    const validation = validateVerificationCode(\n      String(verificationCode),\n      user.verificationCode,\n      user.verificationCodeExpiresAt\n    )\n\n    if (!validation.valid) {\n      return NextResponse.json(\n        { error: validation.message },\n        { status: 400 }\n      )\n    }\n\n    // Mark email as verified and clear verification code\n    const updatedUser = await prisma.user.update({\n      where: { id: user.id },\n      data: {\n        emailVerified: true,\n        verificationCode: null,\n        verificationCodeExpiresAt: null,\n      },\n    })\n\n    // Generate a new token for the user\n    const secret = process.env.JWT_SECRET || 'dev-secret'\n    const token = jwt.sign(\n      { userId: updatedUser.id, role: updatedUser.role, email: updatedUser.email },\n      secret,\n      { expiresIn: '7d' }\n    )\n\n    return NextResponse.json(\n      {\n        ok: true,\n        message: 'Email verified successfully',\n        user: {\n          id: updatedUser.id,\n          email: updatedUser.email,\n          name: updatedUser.name,\n          emailVerified: updatedUser.emailVerified,\n        },\n        token,\n      },\n      { status: 200 }\n    )\n  } catch (e) {\n    console.error('Error verifying email:', e)\n    return NextResponse.json(\n      { error: 'Server error' },\n      { status: 500 }\n    )\n  }\n}\n\nexport async function GET(req: Request) {\n  try {\n    const { searchParams } = new URL(req.url)\n    const email = searchParams.get('email')\n    const code = searchParams.get('code')\n\n    if (!email || !code) {\n      return NextResponse.json(\n        { error: 'Email and code are required' },\n        { status: 400 }\n      )\n    }\n\n    // Find user by email\n    const user = await prisma.user.findUnique({\n      where: { email: String(email).toLowerCase() },\n    })\n\n    if (!user) {\n      return NextResponse.json(\n        { error: 'User not found' },\n        { status: 404 }\n      )\n    }\n\n    // Validate verification code\n    const validation = validateVerificationCode(\n      String(code),\n      user.verificationCode,\n      user.verificationCodeExpiresAt\n    )\n\n    if (!validation.valid) {\n      return NextResponse.json(\n        { error: validation.message },\n        { status: 400 }\n      )\n    }\n\n    // Mark email as verified and clear verification code\n    const updatedUser = await prisma.user.update({\n      where: { id: user.id },\n      data: {\n        emailVerified: true,\n        verificationCode: null,\n        verificationCodeExpiresAt: null,\n      },\n    })\n\n    // Generate a new token for the user\n    const secret = process.env.JWT_SECRET || 'dev-secret'\n    const token = jwt.sign(\n      { userId: updatedUser.id, role: updatedUser.role, email: updatedUser.email },\n      secret,\n      { expiresIn: '7d' }\n    )\n\n    return NextResponse.json(\n      {\n        ok: true,\n        message: 'Email verified successfully',\n        user: {\n          id: updatedUser.id,\n          email: updatedUser.email,\n          name: updatedUser.name,\n          emailVerified: updatedUser.emailVerified,\n        },\n        token,\n      },\n      { status: 200 }\n    )\n  } catch (e) {\n    console.error('Error verifying email:', e)\n    return NextResponse.json(\n      { error: 'Server error' },\n      { status: 500 }\n    )\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}