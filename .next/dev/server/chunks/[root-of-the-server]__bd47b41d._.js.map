{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///home/lod/Downloads/jwrc/app/api/donations/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport { PrismaClient } from \"@prisma/client\"\n\nconst prisma = new PrismaClient()\n\nasync function ensureTable() {\n  await prisma.$executeRawUnsafe(`\n    CREATE TABLE IF NOT EXISTS donations (\n      id SERIAL PRIMARY KEY,\n      amount NUMERIC,\n      currency TEXT,\n      kes_amount INTEGER,\n      method TEXT,\n      donor_name TEXT,\n      donor_email TEXT,\n      note TEXT,\n      created_at TIMESTAMP WITH TIME ZONE DEFAULT now()\n    )\n  `)\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json().catch(() => ({}))\n    const { amount, currency, kesAmount, method, donor } = body || {}\n    if (!amount || !method) return NextResponse.json({ error: 'Missing amount or method' }, { status: 400 })\n\n    await ensureTable()\n    await prisma.$executeRawUnsafe(`INSERT INTO donations (amount, currency, kes_amount, method, donor_name, donor_email, note, created_at) VALUES ($1,$2,$3,$4,$5,$6,$7,NOW())`,\n      amount, currency || 'USD', kesAmount || null, method, donor?.name || null, donor?.email || null, body?.note || null)\n\n    return NextResponse.json({ ok: true }, { status: 201 })\n  } catch (e) {\n    console.error(e)\n    return NextResponse.json({ error: 'Server error' }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,SAAS,IAAI,6IAAY;AAE/B,eAAe;IACb,MAAM,OAAO,iBAAiB,CAAC,CAAC;;;;;;;;;;;;EAYhC,CAAC;AACH;AAEO,eAAe,KAAK,GAAY;IACrC,IAAI;QACF,MAAM,OAAO,MAAM,IAAI,IAAI,GAAG,KAAK,CAAC,IAAM,CAAC,CAAC,CAAC;QAC7C,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAE,MAAM,EAAE,KAAK,EAAE,GAAG,QAAQ,CAAC;QAChE,IAAI,CAAC,UAAU,CAAC,QAAQ,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA2B,GAAG;YAAE,QAAQ;QAAI;QAEtG,MAAM;QACN,MAAM,OAAO,iBAAiB,CAAC,CAAC,2IAA2I,CAAC,EAC1K,QAAQ,YAAY,OAAO,aAAa,MAAM,QAAQ,OAAO,QAAQ,MAAM,OAAO,SAAS,MAAM,MAAM,QAAQ;QAEjH,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,IAAI;QAAK,GAAG;YAAE,QAAQ;QAAI;IACvD,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC;QACd,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAe,GAAG;YAAE,QAAQ;QAAI;IACpE;AACF","debugId":null}}]
}