(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5957],{5272:(e,t,s)=>{Promise.resolve().then(s.bind(s,1291))},1291:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>z});var a=s(926),n=s(5822),r=s(1695),i=s(4567),l=s(826),o=s(4968),c=s(8647),d=s(3565),u=s(5691),m=s(3409),g=s(9841),h=s(8677),x=s(1693),p=s(5376),v=s(9255),f=s(1362),b=s(9225),y=s(3525),j=s(5057),N=s(3612),w=s(2178);function k(e){let{...t}=e;return(0,a.jsx)(N.bL,{"data-slot":"dialog",...t})}function S(e){let{...t}=e;return(0,a.jsx)(N.ZL,{"data-slot":"dialog-portal",...t})}function A(e){let{className:t,...s}=e;return(0,a.jsx)(N.hJ,{"data-slot":"dialog-overlay",className:(0,w.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function C(e){let{className:t,children:s,showCloseButton:n=!0,...r}=e;return(0,a.jsxs)(S,{"data-slot":"dialog-portal",children:[(0,a.jsx)(A,{}),(0,a.jsxs)(N.UC,{"data-slot":"dialog-content",className:(0,w.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r,children:[s,n&&(0,a.jsxs)(N.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(o.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function T(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,w.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function E(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,w.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function D(e){let{className:t,...s}=e;return(0,a.jsx)(N.hE,{"data-slot":"dialog-title",className:(0,w.cn)("text-lg leading-none font-semibold",t),...s})}function F(e){let{className:t,style:s,...n}=e,r={writingMode:"horizontal-tb",transform:"none",...s||{}};return(0,a.jsx)("textarea",{"data-slot":"textarea",className:(0,w.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm resize-y",t),style:r,...n})}var O=s(9407),R=s(5366);function z(){var e;let[t,s]=(0,n.useState)(""),[N,w]=(0,n.useState)(""),[S,A]=(0,n.useState)(!0),[z,_]=(0,n.useState)("overview"),[I,P]=(0,n.useState)(!1),L=(0,r.useRouter)(),[M,Z]=(0,n.useState)([]),[J,U]=(0,n.useState)(""),[V,H]=(0,n.useState)(""),[B,Y]=(0,n.useState)([]),[W,X]=(0,n.useState)({}),[q,G]=(0,n.useState)(null),[Q,K]=(0,n.useState)(!1),[ee,et]=(0,n.useState)(!1),[es,ea]=(0,n.useState)(""),[en,er]=(0,n.useState)(""),[ei,el]=(0,n.useState)(""),[eo,ec]=(0,n.useState)(""),[ed,eu]=(0,n.useState)(""),[em,eg]=(0,n.useState)({}),[eh,ex]=(0,n.useState)(!1);(0,n.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me",{credentials:"include"}),t=await e.json();if(!(null==t?void 0:t.user)||"admin"!==t.user.role){L.push("/admin/login");return}s(t.user.email),w(t.user.name||"")}catch(e){L.push("/admin/login")}})()},[L]),(0,n.useEffect)(()=>{if("announcements"!==z)return;let e=!0;return(async()=>{try{let t=await fetch("/api/announcements",{credentials:"include"}),s=await t.json();if(!e)return;Z((null==s?void 0:s.announcements)||[])}catch(e){console.error("Failed to load announcements",e)}})(),()=>{e=!1}},[z]),(0,n.useEffect)(()=>{if("events"!==z)return;let e=!0;return(async()=>{try{let t=await fetch("/api/events",{credentials:"include"}),s=await t.json();if(!e)return;Y((null==s?void 0:s.events)||[])}catch(e){console.error("Failed to load events",e)}})(),()=>{e=!1}},[z]);let[ep,ev]=(0,n.useState)([]);(0,n.useEffect)(()=>{if("volunteers"!==z)return;let e=!0;return(async()=>{try{let t=await fetch("/api/volunteers",{credentials:"include"}),s=await t.json();if(!e)return;ev((null==s?void 0:s.applications)||[])}catch(e){console.error("Failed to load volunteer applications",e)}})(),()=>{e=!1}},[z]);let[ef,eb]=(0,n.useState)([]),[ey,ej]=(0,n.useState)(null),[eN,ew]=(0,n.useState)(0),[ek,eS]=(0,n.useState)(!1),[eA,eC]=(0,n.useState)(null),[eT,eE]=(0,n.useState)(null),[eD,eF]=(0,n.useState)(null),[eO,eR]=(0,n.useState)(""),[ez,e$]=(0,n.useState)(!1),[e_,eI]=(0,n.useState)(null),{toast:eP}=(0,j.dj)();async function eL(e){if(confirm("Delete this announcement?"))try{let t=await fetch("/api/announcements",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(t.ok)await t.json(),Z(t=>t.filter(t=>t.id!==e));else{let e=await t.json();console.error("Failed to delete announcement",e),alert("Failed to delete announcement: "+((null==e?void 0:e.error)||t.status))}}catch(e){console.error(e),alert("Failed to delete announcement")}}async function eM(e){if(confirm("Delete this event?"))try{let t=await fetch("/api/events",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})});if(t.ok)Y(t=>t.filter(t=>t.id!==e)),eV();else{let e=await t.json();console.error("Failed to delete event",e),alert("Failed to delete event: "+((null==e?void 0:e.error)||t.status))}}catch(e){console.error(e),alert("Failed to delete event")}}(0,n.useEffect)(()=>{if("suggestions"!==z)return;let e=!0;async function t(){try{let t=await fetch("/api/suggestions",{credentials:"include"}),s=await t.json();if(!e)return;eb((null==s?void 0:s.suggestions)||[])}catch(e){console.error("Failed to load suggestions",e)}}t();let s=setInterval(()=>{e&&t()},8e3);return()=>{e=!1,clearInterval(s)}},[z]),(0,n.useEffect)(()=>{let e=!0;try{let e=localStorage.getItem("adminSuggestionsLastSeen");e&&ej(e)}catch(e){}async function t(){try{let t=await fetch("/api/suggestions",{credentials:"include"});if(!t.ok)return;let s=await t.json();if(!e)return;let a=(null==s?void 0:s.suggestions)||[];if(a.length>0){let e=ey?new Date(ey):null,t=e?a.filter(t=>new Date(t.createdAt)>e).length:a.length;ew(t)}else ew(0)}catch(e){}}t();let s=setInterval(t,1e4);return()=>{e=!1,clearInterval(s)}},[ey]),(0,n.useEffect)(()=>{if("suggestions"===z){let e=new Date().toISOString();try{localStorage.setItem("adminSuggestionsLastSeen",e)}catch(e){}ej(e),ew(0)}},[z]);let eZ=async()=>{try{let e=await fetch("/api/auth/refresh",{method:"POST",credentials:"include"}),t=await e.json();e.ok?(alert("Session refreshed successfully! Your admin permissions are now active."),window.location.reload()):alert("Failed to refresh session: "+((null==t?void 0:t.error)||"Unknown error"))}catch(e){console.error(e),alert("Failed to refresh session")}},[eJ,eU]=(0,n.useState)({volunteerCount:0,eventCount:0}),eV=async()=>{try{let[e,t]=await Promise.all([fetch("/api/volunteers",{credentials:"include"}),fetch("/api/events",{credentials:"include"})]),[s,a]=await Promise.all([e.json().catch(()=>({})),t.json().catch(()=>({}))]),n=((null==s?void 0:s.applications)||[]).filter(e=>"approved"===e.status).length,r=new Date;r.setHours(0,0,0,0);let i=((null==a?void 0:a.events)||[]).filter(e=>new Date(e.startsAt)>=r).length;eU({volunteerCount:n||0,eventCount:i||0})}catch(e){console.error("Failed to load stats",e)}};(0,n.useEffect)(()=>{eV()},[]);let eH=[{label:"Active Volunteers",value:eJ.volunteerCount.toString(),change:"Approved",icon:i.A,color:"blue"},{label:"Upcoming Events",value:eJ.eventCount.toString(),change:"This month",icon:l.A,color:"orange"}],[eB,eY]=(0,n.useState)([]);return(0,n.useEffect)(()=>{(async function(){try{let[e,t,s,a]=await Promise.all([fetch("/api/announcements",{credentials:"include"}),fetch("/api/volunteers",{credentials:"include"}),fetch("/api/suggestions",{credentials:"include"}),fetch("/api/events",{credentials:"include"})]),[n,r,i,l]=await Promise.all([e.json().catch(()=>({})),t.json().catch(()=>({})),s.json().catch(()=>({})),a.json().catch(()=>({}))]),o=[...((null==n?void 0:n.announcements)||[]).slice(0,2).map(e=>({id:e.id,type:"announcement",user:e.author||"Admin",text:e.title,time:e.postedAt?new Date(e.postedAt).toLocaleDateString():"Recent",status:"posted"})),...((null==r?void 0:r.applications)||[]).slice(0,2).map(e=>({id:e.id,type:"volunteer",user:e.name||"Volunteer",role:e.roleTitle||e.status,time:e.createdAt?new Date(e.createdAt).toLocaleDateString():"Recent",status:e.status||"pending"})),...((null==i?void 0:i.suggestions)||[]).slice(0,2).map(e=>({id:e.id,type:"suggestion",user:e.name||"User",text:e.message,time:e.createdAt?new Date(e.createdAt).toLocaleDateString():"Recent",status:e.status||"new"})),...((null==l?void 0:l.events)||[]).slice(0,2).map(e=>({id:e.id,type:"event",title:e.title,participants:"TBD",time:e.startsAt?new Date(e.startsAt).toLocaleDateString():"Recent",status:"upcoming"}))].sort(()=>Math.random()-.5).slice(0,4);eY(o)}catch(e){console.error("Failed to load activities",e)}})()},[]),(0,a.jsxs)("div",{className:"min-h-screen bg-gray-100 dark:bg-slate-900",children:[(0,a.jsx)("header",{className:"bg-white dark:bg-slate-800 shadow sticky top-0 z-40",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 py-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("button",{onClick:()=>A(!S),className:"lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-700",children:S?(0,a.jsx)(o.A,{className:"w-6 h-6"}):(0,a.jsx)(c.A,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Admin Dashboard"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:t})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)(y.$,{onClick:eZ,variant:"outline",className:"border-blue-200 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 bg-transparent",children:[(0,a.jsx)(d.A,{className:"w-4 h-4 mr-2"}),"Refresh Session"]}),(0,a.jsxs)(y.$,{onClick:()=>{fetch("/api/auth/logout",{method:"POST"}).finally(()=>L.push("/admin/login"))},variant:"outline",className:"border-red-200 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 bg-transparent",children:[(0,a.jsx)(u.A,{className:"w-4 h-4 mr-2"}),"Logout"]})]})]})}),(0,a.jsxs)("div",{className:"flex h-[calc(100vh-70px)]",children:[(0,a.jsx)("aside",{className:"".concat(S?"w-64":"w-0"," bg-gray-900 text-white overflow-y-auto transition-all duration-300 hidden lg:block"),children:(0,a.jsx)("nav",{className:"p-6 space-y-2",children:[{label:"Overview",icon:m.A,id:"overview"},{label:"Announcements",icon:g.A,id:"announcements"},{label:"Events",icon:l.A,id:"events"},{label:"Volunteers",icon:i.A,id:"volunteers"},{label:"Suggestions",icon:g.A,id:"suggestions"},{label:"Settings",icon:h.A,id:"settings"}].map(e=>(0,a.jsxs)("button",{onClick:()=>_(e.id),className:"w-full flex items-center gap-3 px-4 py-3 rounded-lg transition ".concat(z===e.id?"bg-blue-600 text-white":"text-gray-400 hover:bg-gray-800"),children:[(0,a.jsx)(e.icon,{className:"w-5 h-5"}),(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{children:e.label}),"suggestions"===e.id&&eN>0&&(0,a.jsx)("span",{className:"text-xs bg-red-600 text-white rounded-full px-2 py-0.5",children:eN})]})]},e.id))})}),(0,a.jsxs)("main",{className:"flex-1 overflow-y-auto p-6",children:["overview"===z&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:eH.map((e,t)=>(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-".concat(e.color,"-100 dark:bg-").concat(e.color,"-900/30 rounded-lg flex items-center justify-center"),children:(0,a.jsx)(e.icon,{className:"w-6 h-6 text-".concat(e.color,"-600")})}),(0,a.jsx)(x.A,{className:"w-5 h-5 text-".concat(e.color,"-600")})]}),(0,a.jsx)("h3",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.label}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white mt-1",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-".concat(e.color,"-600 mt-2"),children:e.change})]},t))}),(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-6",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4 flex items-center gap-2",children:[(0,a.jsx)(d.A,{className:"w-6 h-6"}),"Recent Activity"]}),(0,a.jsx)("div",{className:"space-y-3",children:eB.map(e=>(0,a.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700 rounded-lg",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium text-gray-900 dark:text-white",children:["volunteer"===e.type&&"".concat(e.user," signed up for ").concat(e.role),"suggestion"===e.type&&"".concat(e.user,': "').concat(e.text,'"'),"event"===e.type&&"".concat(e.title," coming up"),"announcement"===e.type&&"Announcement: ".concat(e.text)]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.time})]}),(0,a.jsx)(R.E,{className:"".concat("completed"===e.status||"posted"===e.status?"bg-green-600":"pending"===e.status?"bg-yellow-600":"upcoming"===e.status?"bg-blue-600":"bg-gray-600"),children:e.status})]},e.id))})]})]}),"announcements"===z&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Manage Announcements"}),(0,a.jsxs)(y.$,{onClick:()=>P(!I),className:"bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"Add Announcement"]})]}),I&&(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Create New Announcement"}),(0,a.jsxs)("form",{className:"space-y-4",onSubmit:async e=>{e.preventDefault();try{let e=await fetch("/api/announcements",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:J,content:V})});if(e.ok){let e=await (await fetch("/api/announcements")).json();Z((null==e?void 0:e.announcements)||[]),P(!1),U(""),H("")}else{let t=await e.json().catch(()=>({}));console.error("Failed to publish announcement",t),alert("Failed to publish announcement: "+((null==t?void 0:t.error)||e.status))}}catch(e){console.error(e),alert("Failed to publish announcement")}},children:[(0,a.jsx)("input",{type:"text",value:J,onChange:e=>U(e.target.value),placeholder:"Announcement Title",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-slate-700 dark:text-white"}),(0,a.jsx)("textarea",{placeholder:"Announcement Content",rows:4,value:V,onChange:e=>H(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-slate-700 dark:text-white"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(y.$,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",children:"Publish"}),(0,a.jsx)(y.$,{type:"button",variant:"outline",onClick:()=>P(!1),children:"Cancel"})]})]})]}),(0,a.jsx)("div",{className:"space-y-3",children:M.map(e=>(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.postedAt?new Date(e.postedAt).toLocaleDateString():""})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(R.E,{className:"bg-green-600",children:"active"}),(0,a.jsx)(y.$,{size:"sm",variant:"outline",children:(0,a.jsx)(v.A,{className:"w-4 h-4"})}),(0,a.jsx)(y.$,{size:"sm",variant:"outline",className:"text-red-600 border-red-200 bg-transparent",onClick:()=>eL(e.id),children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]})]},e.id))})]}),"events"===z&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Manage Events"}),(0,a.jsxs)(y.$,{onClick:()=>et(!ee),className:"bg-blue-600 hover:bg-blue-700",children:[(0,a.jsx)(p.A,{className:"w-4 h-4 mr-2"}),"Add Event"]})]}),ee&&(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Create New Event"}),(0,a.jsxs)("form",{className:"space-y-4",onSubmit:async e=>{e.preventDefault();let t={};if(es&&0!==es.trim().length||(t.title="Title is required"),eo?isNaN(Date.parse(eo))&&(t.startsAt="Start date/time is invalid"):t.startsAt="Start date/time is required",ed&&isNaN(Date.parse(ed))&&(t.endsAt="End date/time is invalid"),eo&&ed&&!t.startsAt&&!t.endsAt){let e=Date.parse(eo),s=Date.parse(ed);isNaN(e)||isNaN(s)||!(s<e)||(t.endsAt="End must be after start")}if(Object.keys(t).length>0){eg(t);return}ex(!0),eg({});try{let e=await fetch("/api/events",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:es,description:en,location:ei,startsAt:eo,endsAt:ed})});if(e.ok){let e=await (await fetch("/api/events")).json();Y((null==e?void 0:e.events)||[]),eV(),et(!1),ea(""),er(""),el(""),ec(""),eu("")}else{let t=await e.json().catch(()=>({}));console.error("Failed to create event",t),(null==t?void 0:t.errors)?eg(t.errors):alert("Failed to create event: "+((null==t?void 0:t.error)||e.status))}}catch(e){console.error(e),alert("Failed to create event")}finally{ex(!1)}},children:[(0,a.jsx)("input",{type:"text",value:es,onChange:e=>{ea(e.target.value),eg(e=>{let t={...e};return delete t.title,t})},placeholder:"Event Title",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-slate-700 dark:text-white"}),em.title&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:em.title}),(0,a.jsx)("input",{type:"datetime-local",value:eo,onChange:e=>{ec(e.target.value),eg(e=>{let t={...e};return delete t.startsAt,t})},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-slate-700 dark:text-white"}),em.startsAt&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:em.startsAt}),(0,a.jsx)("input",{type:"datetime-local",value:ed,onChange:e=>{eu(e.target.value),eg(e=>{let t={...e};return delete t.endsAt,t})},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-slate-700 dark:text-white"}),em.endsAt&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-1",children:em.endsAt}),(0,a.jsx)("input",{type:"text",value:ei,onChange:e=>el(e.target.value),placeholder:"Location",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-slate-700 dark:text-white"}),(0,a.jsx)("textarea",{value:en,onChange:e=>er(e.target.value),placeholder:"Description",rows:3,className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-slate-700 dark:text-white"}),(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(y.$,{type:"submit",className:"bg-blue-600 hover:bg-blue-700",children:"Create"}),(0,a.jsx)(y.$,{type:"button",variant:"outline",onClick:()=>et(!1),children:"Cancel"})]})]})]}),(0,a.jsx)("div",{className:"space-y-3",children:B.map(e=>(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.startsAt?new Date(e.startsAt).toLocaleString():""})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)(y.$,{size:"sm",variant:"outline",onClick:async()=>{try{let t=await fetch("/api/events/signups?eventId=".concat(e.id),{credentials:"include"});if(t.ok){let s=await t.json();X(t=>({...t,[e.id]:(null==s?void 0:s.signups)||[]})),G(e.id),K(!0)}else{let e=await t.json().catch(()=>({}));alert("Failed to load signups: "+((null==e?void 0:e.error)||t.status))}}catch(e){console.error(e),alert("Failed to load signups")}},children:(0,a.jsx)(b.A,{className:"w-4 h-4"})}),(0,a.jsx)(y.$,{size:"sm",variant:"outline",children:(0,a.jsx)(v.A,{className:"w-4 h-4"})}),(0,a.jsx)(y.$,{size:"sm",variant:"outline",className:"text-red-600 border-red-200 bg-transparent",onClick:()=>eM(e.id),children:(0,a.jsx)(f.A,{className:"w-4 h-4"})})]})]},e.id))}),Q&&q&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-800 w-[min(900px,95%)] max-h-[80vh] overflow-auto p-6 rounded shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold",children:["Signups for ",(null===(e=B.find(e=>e.id===q))||void 0===e?void 0:e.title)||""]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.$,{className:"bg-green-600 hover:bg-green-700",onClick:async()=>{if(confirm("Send reminder emails to all ".concat((W[q]||[]).length," signup(s)?")))try{let e=await fetch("/api/events/signups/send-reminder",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:q})}),t=await e.json();e.ok?alert(t.message||"Sent ".concat(t.sent," reminder(s) successfully")):alert("Failed to send reminders: "+((null==t?void 0:t.error)||e.status))}catch(e){console.error(e),alert("Failed to send reminders")}},children:"Send Reminders to All"}),(0,a.jsx)(y.$,{variant:"outline",onClick:()=>{let e=new Blob([[["Name","Email","Phone","Created At"],...(W[q]||[]).map(e=>[e.name,e.email,e.phone||"",e.createdAt?new Date(e.createdAt).toISOString():""])].map(e=>e.map(e=>'"'.concat(String(e||"").replace(/"/g,'""'),'"')).join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="signups_".concat(q,".csv"),document.body.appendChild(s),s.click(),s.remove(),URL.revokeObjectURL(t)},children:"Export CSV"}),(0,a.jsx)(y.$,{variant:"outline",onClick:()=>{K(!1),G(null)},children:"Close"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(W[q]||[]).map(e=>(0,a.jsxs)(O.Zp,{className:"p-3 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"font-medium",children:[e.name," ",(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.email})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.phone||""})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400 mr-4",children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),(0,a.jsx)(y.$,{size:"sm",variant:"destructive",onClick:async()=>{if(confirm("Remove this signup?"))try{let t=await fetch("/api/events/signups",{method:"DELETE",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})});if(t.ok)X(t=>({...t,[q]:(t[q]||[]).filter(t=>t.id!==e.id)}));else{let e=await t.json().catch(()=>({}));alert("Failed to remove signup: "+((null==e?void 0:e.error)||t.status))}}catch(e){console.error(e),alert("Failed to remove signup")}},children:"Remove"})]})]},e.id)),0===(W[q]||[]).length&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No signups yet."})]})]})})]}),"volunteers"===z&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Volunteer Applications"})}),(0,a.jsxs)("div",{className:"space-y-3",children:[ep.map(e=>(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.email," â€¢ ",e.roleTitle||e.roleId]}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Status: ",e.status]}),e.adminMessage&&(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Message: ",e.adminMessage]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(y.$,{size:"sm",className:"bg-green-600",onClick:async()=>{let t=prompt("Optional message to the applicant (approval note)");try{let s=await fetch("/api/volunteers",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,action:"approve",message:t})});if(s.ok)ev(s=>s.map(s=>s.id===e.id?{...s,status:"approved",adminMessage:t}:s));else{let e=await s.json().catch(()=>({}));alert("Failed to approve: "+((null==e?void 0:e.error)||s.status))}}catch(e){console.error(e),alert("Failed to approve")}},children:"Approve"}),(0,a.jsx)(y.$,{size:"sm",className:"bg-red-600",onClick:async()=>{let t=prompt("Message to applicant (reason for rejection)");if(null!==t)try{let s=await fetch("/api/volunteers",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id,action:"reject",message:t})});if(s.ok)ev(s=>s.map(s=>s.id===e.id?{...s,status:"rejected",adminMessage:t}:s));else{let e=await s.json().catch(()=>({}));alert("Failed to reject: "+((null==e?void 0:e.error)||s.status))}}catch(e){console.error(e),alert("Failed to reject")}},children:"Reject"})]})]},e.id)),0===ep.length&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No volunteer applications yet."})]})]}),"suggestions"===z&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Suggestions"}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[eN>0&&(0,a.jsxs)("span",{className:"text-sm text-white bg-red-600 rounded-full px-2 py-0.5",children:[eN," new"]}),(0,a.jsx)(y.$,{size:"sm",onClick:async()=>{try{let e=await fetch("/api/suggestions",{credentials:"include"});if(e.ok){let t=await e.json();eb((null==t?void 0:t.suggestions)||[]);let s=new Date().toISOString();try{localStorage.setItem("adminSuggestionsLastSeen",s)}catch(e){}ej(s),ew(0)}else{let t=await e.json().catch(()=>({}));alert("Failed to refresh suggestions: "+((null==t?void 0:t.error)||e.status))}}catch(e){console.error(e),alert("Failed to refresh suggestions")}},children:"Refresh"})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[ef.map(e=>(0,a.jsxs)(O.Zp,{className:"bg-white dark:bg-slate-800 p-4 flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:[e.type," from ",e.name||e.email]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.message}),e.adminResponse&&(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:["Response: ",e.adminResponse," ",e.responderName?(0,a.jsxs)("span",{className:"text-xs text-gray-400",children:["(by ",e.responderName,")"]}):null]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(y.$,{size:"sm",onClick:()=>{eC(e.id),eE(e.email||null),eF(e.name||null),eR(e.adminResponse||""),eS(!0)},children:"Respond"})})]},e.id)),0===ef.length&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"No suggestions yet."})]})]}),(0,a.jsx)(k,{open:ek,onOpenChange:e=>{e||(eC(null),eR("")),eS(e)},children:(0,a.jsxs)(C,{children:[(0,a.jsx)(T,{children:(0,a.jsx)(D,{children:"Respond to Suggestion"})}),(0,a.jsxs)("div",{className:"mt-2 space-y-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)(F,{className:"w-full min-h-[200px]",value:eO,onChange:e=>{eR(e.target.value),e_&&eI(null)},placeholder:"Write your response to the suggestion here"})}),e_&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-2",children:e_})]}),(0,a.jsxs)(E,{children:[(0,a.jsx)(y.$,{variant:"outline",onClick:()=>{eS(!1),eI(null)},children:"Cancel"}),(0,a.jsx)(y.$,{disabled:ez||0===eO.trim().length,onClick:async()=>{if(eA){if(0===eO.trim().length){eI("Response cannot be empty");return}e$(!0),eI(null);try{let e=await fetch("/api/suggestions",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:eA,response:eO,responderName:N})});if(e.ok)eb(e=>e.map(e=>e.id===eA?{...e,adminResponse:eO,respondedAt:new Date().toISOString(),responderName:N||"You"}:e)),eS(!1),eC(null),eE(null),eF(null),eR(""),eP({title:"Response sent",description:"Your reply was delivered to the user."});else{let t=await e.json().catch(()=>({})),s=(null==t?void 0:t.error)||"Status ".concat(e.status);eI("Failed to send response: "+s)}}catch(e){console.error(e),eI("Network or server error")}finally{e$(!1)}}},children:ez?"Sending...":"Send Response"})]})]})}),"settings"===z&&(0,a.jsx)($,{adminName:N,toast:eP})]})]})]})}function $(e){let{adminName:t,toast:s}=e,[r,i]=(0,n.useState)(""),[l,o]=(0,n.useState)(""),[c,d]=(0,n.useState)(!1),[u,m]=(0,n.useState)(!1);async function g(){d(!0);try{let e=await fetch("/api/settings",{credentials:"include"}),t=await e.json();(null==t?void 0:t.settings)&&(i(String(t.settings.activeMembers||"")),o(String(t.settings.ministryPartnerships||"")))}catch(e){console.error("Failed to load settings",e)}finally{d(!1)}}async function h(){m(!0);try{(await fetch("/api/settings",{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({activeMembers:Number(r)||0,ministryPartnerships:Number(l)||0})})).ok?s({title:"Settings saved",description:"Church statistics have been updated."}):s({title:"Error",description:"Failed to save settings",variant:"destructive"})}catch(e){console.error("Failed to save settings",e),s({title:"Error",description:"Network error",variant:"destructive"})}finally{m(!1)}}return((0,n.useEffect)(()=>{g()},[]),c)?(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsx)("div",{className:"text-gray-500",children:"Loading settings..."})}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Church Settings"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Manage church statistics displayed on the About page"})]}),(0,a.jsx)(O.Zp,{className:"p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Active Members"}),(0,a.jsx)("input",{type:"number",value:r,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",placeholder:"2000",min:"0"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Number of active church members"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Ministry Partnerships"}),(0,a.jsx)("input",{type:"number",value:l,onChange:e=>o(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500",placeholder:"50",min:"0"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Number of ministry partnerships"})]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg mb-4",children:(0,a.jsxs)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:[(0,a.jsx)("strong",{children:"Note:"})," Years Serving is automatically calculated from Feb 7, 2020 (founding date). Weekly Programs count is automatically calculated from scheduled events in the next 7 days."]})}),(0,a.jsx)(y.$,{onClick:h,disabled:u,className:"w-full sm:w-auto",children:u?"Saving...":"Save Settings"})]})]})})]})}},5366:(e,t,s)=>{"use strict";s.d(t,{E:()=>o});var a=s(926);s(5822);var n=s(7897),r=s(8341),i=s(2178);let l=(0,r.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:s,asChild:r=!1,...o}=e,c=r?n.DX:"span";return(0,a.jsx)(c,{"data-slot":"badge",className:(0,i.cn)(l({variant:s}),t),...o})}},3525:(e,t,s)=>{"use strict";s.d(t,{$:()=>o});var a=s(926);s(5822);var n=s(7897),r=s(8341),i=s(2178);let l=(0,r.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9","icon-sm":"size-8","icon-lg":"size-10"}},defaultVariants:{variant:"default",size:"default"}});function o(e){let{className:t,variant:s,size:r,asChild:o=!1,...c}=e,d=o?n.DX:"button";return(0,a.jsx)(d,{"data-slot":"button",className:(0,i.cn)(l({variant:s,size:r,className:t})),...c})}},9407:(e,t,s)=>{"use strict";s.d(t,{BT:()=>o,Wu:()=>c,ZB:()=>l,Zp:()=>r,aR:()=>i});var a=s(926);s(5822);var n=s(2178);function r(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,n.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",t),...s})}function i(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,n.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",t),...s})}function l(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,n.cn)("leading-none font-semibold",t),...s})}function o(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...s})}function c(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,n.cn)("px-6",t),...s})}},5057:(e,t,s)=>{"use strict";s.d(t,{dj:()=>m});var a=s(5822);let n=0,r=new Map,i=e=>{if(r.has(e))return;let t=setTimeout(()=>{r.delete(e),d({type:"REMOVE_TOAST",toastId:e})},1e6);r.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?i(s):e.toasts.forEach(e=>{i(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},o=[],c={toasts:[]};function d(e){c=l(c,e),o.forEach(e=>{e(c)})}function u(e){let{...t}=e,s=(n=(n+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>d({type:"DISMISS_TOAST",toastId:s});return d({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>d({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function m(){let[e,t]=a.useState(c);return a.useEffect(()=>(o.push(t),()=>{let e=o.indexOf(t);e>-1&&o.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>d({type:"DISMISS_TOAST",toastId:e})}}},2178:(e,t,s)=>{"use strict";s.d(t,{cn:()=>r});var a=s(589),n=s(9704);function r(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.QP)((0,a.$)(t))}}},e=>{var t=t=>e(e.s=t);e.O(0,[1085,5833,3709,8304,6683,7358],()=>t(5272)),_N_E=e.O()}]);