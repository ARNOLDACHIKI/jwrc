(()=>{var e={};e.id=8301,e.ids=[8301],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},82465:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>m,serverHooks:()=>w,workAsyncStorage:()=>j,workUnitAsyncStorage:()=>R});var s={};r.r(s),r.d(s,{DELETE:()=>h,GET:()=>f,POST:()=>v,dynamic:()=>x});var n=r(62137),a=r(63654),o=r(48093),i=r(63e3),u=r(96330),d=r(77136),p=r.n(d);let l=new u.PrismaClient;function c(e){let t=(e.headers.get("cookie")||"").split(";").map(e=>e.trim()).find(e=>e.startsWith("token="));return t?t.split("=")[1]:null}let x="force-dynamic";async function f(e){try{let t=new URL(e.url),r=Math.max(1,parseInt(t.searchParams.get("page")||"1",10)),s=Math.max(1,Math.min(50,parseInt(t.searchParams.get("pageSize")||"10",10))),n="true"===t.searchParams.get("futureOnly"),a={};n&&(a.startsAt={gte:new Date});let o=await l.event.count({where:a}),u=await l.event.findMany({where:a,orderBy:{startsAt:"asc"},skip:(r-1)*s,take:s});return i.NextResponse.json({events:u,total:o,page:r,pageSize:s})}catch(e){return i.NextResponse.json({error:"Failed to fetch events"},{status:500})}}async function v(e){try{let t=c(e),r=process.env.JWT_SECRET||"dev-secret";if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let s=null;try{s=p().verify(t,r)}catch(e){return i.NextResponse.json({error:"Unauthorized"},{status:401})}let n=await l.user.findUnique({where:{id:s.userId}});if(!n)return i.NextResponse.json({error:"User not found"},{status:401});if("admin"!==n.role)return i.NextResponse.json({error:"Forbidden"},{status:403});let{title:a,description:o,location:u,startsAt:d,endsAt:x}=await e.json()||{},f={};a&&0!==String(a).trim().length||(f.title="Title is required"),d||(f.startsAt="Start date/time is required");let v=null,h=null;if(d){let e=Date.parse(d);isNaN(e)?f.startsAt="Start date/time is invalid":v=new Date(e)}if(x){let e=Date.parse(x);isNaN(e)?f.endsAt="End date/time is invalid":h=new Date(e)}if(v&&h&&h<v&&(f.endsAt="End must be after start"),Object.keys(f).length>0)return i.NextResponse.json({errors:f},{status:400});let m=await l.event.create({data:{title:String(a),description:o||"",location:u||"",startsAt:v,endsAt:h||null}});return i.NextResponse.json({event:m},{status:201})}catch(e){return i.NextResponse.json({error:"Server error"},{status:500})}}async function h(e){try{let t=c(e),r=process.env.JWT_SECRET||"dev-secret";if(!t)return i.NextResponse.json({error:"Unauthorized"},{status:401});let s=null;try{s=p().verify(t,r)}catch(e){return i.NextResponse.json({error:"Unauthorized"},{status:401})}let n=await l.user.findUnique({where:{id:s.userId}});if(!n)return i.NextResponse.json({error:"User not found"},{status:401});if("admin"!==n.role)return i.NextResponse.json({error:"Forbidden"},{status:403});let{id:a}=await e.json()||{};if(!a)return i.NextResponse.json({error:"Missing id"},{status:400});try{let e=await l.event.delete({where:{id:a}});return i.NextResponse.json({deleted:e})}catch(e){if("P2025"===e.code)return i.NextResponse.json({error:"Not found"},{status:404});return i.NextResponse.json({error:"Failed to delete"},{status:500})}}catch(e){return i.NextResponse.json({error:"Server error"},{status:500})}}let m=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/events/route",pathname:"/api/events",filename:"route",bundlePath:"app/api/events/route"},resolvedPagePath:"/home/lod/Downloads/jwrc/app/api/events/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:j,workUnitAsyncStorage:R,serverHooks:w}=m;function y(){return(0,o.patchFetch)({workAsyncStorage:j,workUnitAsyncStorage:R})}},62290:()=>{},51674:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[5089,9862,7136],()=>r(82465));module.exports=s})();