(()=>{var e={};e.id=7758,e.ids=[7758],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},68069:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>v,routeModule:()=>g,serverHooks:()=>h,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>x,dynamic:()=>d});var i=t(62137),o=t(63654),n=t(48093),a=t(63e3),u=t(29383),p=t(77136),l=t.n(p);let c=new(t(96330)).PrismaClient,d="force-dynamic";function m(e){let r=e.toLowerCase();if(r.includes("@gmail.com")){let[e,t]=r.split("@");return e.replace(/\./g,"")+"@"+t}return r}async function x(e){try{let{email:r,password:t}=await e.json();if(!r||!t)return a.NextResponse.json({error:"Missing credentials"},{status:400});let s=await c.user.findUnique({where:{email:r}});if(!s&&r.toLowerCase().includes("@gmail.com")){let e=m(r);s=(await c.user.findMany({where:{email:{contains:"@gmail.com",mode:"insensitive"}}})).find(r=>m(r.email)===e)||null}if(!s)try{s=await c.user.findFirst({where:{email:{equals:r,mode:"insensitive"}}})}catch(e){}if(!s)return a.NextResponse.json({error:"No account found. Please register."},{status:404});if(!(s.password&&await u.Ay.compare(t,s.password)))return a.NextResponse.json({error:"Invalid email or password"},{status:401});let i=process.env.JWT_SECRET||"dev-secret",o=l().sign({userId:s.id,role:s.role,email:s.email},i,{expiresIn:"7d"}),n=`token=${o}; HttpOnly; Path=/; Max-Age=604800; SameSite=Lax`;return a.NextResponse.json({ok:!0,token:o},{status:200,headers:{"Set-Cookie":n}})}catch(e){return console.error("Login error:",e),a.NextResponse.json({error:"Server error"},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/home/lod/Downloads/jwrc/app/api/auth/login/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:h}=g;function v(){return(0,n.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}},62290:()=>{},51674:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5089,9862,7136,9383],()=>t(68069));module.exports=s})();