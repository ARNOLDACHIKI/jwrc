(()=>{var e={};e.id=3887,e.ids=[3887],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},77390:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>y,routeModule:()=>x,serverHooks:()=>h,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>w});var i={};t.r(i),t.d(i,{GET:()=>v,POST:()=>m,dynamic:()=>f});var s=t(62137),a=t(63654),n=t(48093),o=t(63e3),u=t(96330),d=t(18816),l=t(77136),c=t.n(l);let p=new u.PrismaClient,f="force-dynamic";async function m(e){try{let{email:r,verificationCode:t}=await e.json()||{};if(!r||!t)return o.NextResponse.json({error:"Email and verification code are required"},{status:400});let i=await p.user.findUnique({where:{email:String(r).toLowerCase()}});if(!i)return o.NextResponse.json({error:"User not found"},{status:404});let s=(0,d.ff)(String(t),i.verificationCode,i.verificationCodeExpiresAt);if(!s.valid)return o.NextResponse.json({error:s.message},{status:400});let a=await p.user.update({where:{id:i.id},data:{emailVerified:!0,verificationCode:null,verificationCodeExpiresAt:null}}),n=process.env.JWT_SECRET||"dev-secret",u=c().sign({userId:a.id,role:a.role,email:a.email},n,{expiresIn:"7d"});return o.NextResponse.json({ok:!0,message:"Email verified successfully",user:{id:a.id,email:a.email,name:a.name,emailVerified:a.emailVerified},token:u},{status:200})}catch(e){return console.error("Error verifying email:",e),o.NextResponse.json({error:"Server error"},{status:500})}}async function v(e){try{let{searchParams:r}=new URL(e.url),t=r.get("email"),i=r.get("code");if(!t||!i)return o.NextResponse.json({error:"Email and code are required"},{status:400});let s=await p.user.findUnique({where:{email:String(t).toLowerCase()}});if(!s)return o.NextResponse.json({error:"User not found"},{status:404});let a=(0,d.ff)(String(i),s.verificationCode,s.verificationCodeExpiresAt);if(!a.valid)return o.NextResponse.json({error:a.message},{status:400});let n=await p.user.update({where:{id:s.id},data:{emailVerified:!0,verificationCode:null,verificationCodeExpiresAt:null}}),u=process.env.JWT_SECRET||"dev-secret",l=c().sign({userId:n.id,role:n.role,email:n.email},u,{expiresIn:"7d"});return o.NextResponse.json({ok:!0,message:"Email verified successfully",user:{id:n.id,email:n.email,name:n.name,emailVerified:n.emailVerified},token:l},{status:200})}catch(e){return console.error("Error verifying email:",e),o.NextResponse.json({error:"Server error"},{status:500})}}let x=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/verify-email/route",pathname:"/api/auth/verify-email",filename:"route",bundlePath:"app/api/auth/verify-email/route"},resolvedPagePath:"/home/lod/Downloads/jwrc/app/api/auth/verify-email/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:g,workUnitAsyncStorage:w,serverHooks:h}=x;function y(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:w})}},62290:()=>{},51674:()=>{},18816:(e,r,t)=>{"use strict";function i(){return Math.floor(1e5+9e5*Math.random()).toString()}function s(){let e=new Date;return e.setMinutes(e.getMinutes()+30),e}function a(e,r,t){return r?!t||new Date>t?{valid:!1,message:"Verification code has expired"}:e!==r?{valid:!1,message:"Invalid verification code"}:{valid:!0,message:"Verification successful"}:{valid:!1,message:"No verification code found"}}t.d(r,{cb:()=>s,ff:()=>a,u8:()=>i})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[5089,9862,7136],()=>t(77390));module.exports=i})();