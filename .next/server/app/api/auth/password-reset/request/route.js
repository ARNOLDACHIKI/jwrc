(()=>{var e={};e.id=2648,e.ids=[2648],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79646:e=>{"use strict";e.exports=require("child_process")},55511:e=>{"use strict";e.exports=require("crypto")},14985:e=>{"use strict";e.exports=require("dns")},94735:e=>{"use strict";e.exports=require("events")},29021:e=>{"use strict";e.exports=require("fs")},81630:e=>{"use strict";e.exports=require("http")},55591:e=>{"use strict";e.exports=require("https")},91645:e=>{"use strict";e.exports=require("net")},21820:e=>{"use strict";e.exports=require("os")},33873:e=>{"use strict";e.exports=require("path")},27910:e=>{"use strict";e.exports=require("stream")},34631:e=>{"use strict";e.exports=require("tls")},79551:e=>{"use strict";e.exports=require("url")},28354:e=>{"use strict";e.exports=require("util")},74075:e=>{"use strict";e.exports=require("zlib")},26738:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>q,routeModule:()=>w,serverHooks:()=>h,workAsyncStorage:()=>E,workUnitAsyncStorage:()=>S});var s={};t.r(s),t.d(s,{POST:()=>l,dynamic:()=>T});var o=t(62137),a=t(63654),i=t(48093),n=t(63e3),u=t(96330),p=t(55511);let c=new u.PrismaClient;async function d(){await c.$executeRawUnsafe(`
    CREATE TABLE IF NOT EXISTS password_reset_tokens (
      id TEXT PRIMARY KEY,
      user_id TEXT NOT NULL,
      token TEXT NOT NULL,
      expires_at TIMESTAMP WITH TIME ZONE NOT NULL,
      used BOOLEAN DEFAULT false,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT now(),
      used_at TIMESTAMP WITH TIME ZONE
    )
  `),await c.$executeRawUnsafe("CREATE INDEX IF NOT EXISTS password_reset_tokens_token_idx ON password_reset_tokens(token)")}async function x(e){let r=await c.user.findUnique({where:{email:e}});if(!r)try{r=await c.user.findFirst({where:{email:{equals:e,mode:"insensitive"}}})}catch(e){}return r}let T="force-dynamic";async function l(e){try{let{email:r}=await e.json()||{};if(!r)return n.NextResponse.json({error:"Email required"},{status:400});let s=await x(String(r));if(await d(),!s)return n.NextResponse.json({error:"No account found with this email address. Please register first."},{status:404});let o=(0,p.randomBytes)(24).toString("hex"),a=(0,p.randomBytes)(12).toString("hex"),i=new Date(Date.now()+36e5);await c.$executeRawUnsafe("INSERT INTO password_reset_tokens (id, user_id, token, expires_at, used, created_at) VALUES ($1,$2,$3,$4,false,NOW())",a,s.id,o,i);try{if(process.env.SMTP_HOST&&process.env.SMTP_USER){let e=(await t.e(3040).then(t.t.bind(t,83040,19))).createTransport({host:process.env.SMTP_HOST,port:Number(process.env.SMTP_PORT||587),secure:"true"===process.env.SMTP_SECURE,auth:{user:process.env.SMTP_USER,pass:process.env.SMTP_PASS}}),r=process.env.SITE_URL||"http://localhost:3000",a=`${r}/reset-password?token=${o}`;return await e.sendMail({from:process.env.SMTP_FROM||process.env.SMTP_USER,to:s.email,subject:"Password reset request",text:`You requested a password reset. Use this link to reset your password: ${a} (expires in 1 hour)`}),n.NextResponse.json({ok:!0})}}catch(e){console.warn("Failed to send password reset email",e)}return n.NextResponse.json({ok:!0})}catch(e){return console.error(e),n.NextResponse.json({error:"Server error"},{status:500})}}let w=new o.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/auth/password-reset/request/route",pathname:"/api/auth/password-reset/request",filename:"route",bundlePath:"app/api/auth/password-reset/request/route"},resolvedPagePath:"/home/lod/Downloads/jwrc/app/api/auth/password-reset/request/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:E,workUnitAsyncStorage:S,serverHooks:h}=w;function q(){return(0,i.patchFetch)({workAsyncStorage:E,workUnitAsyncStorage:S})}},62290:()=>{},51674:()=>{}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5089,9862],()=>t(26738));module.exports=s})();