(()=>{var e={};e.id=2658,e.ids=[2658],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},99333:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>j,routeModule:()=>w,serverHooks:()=>v,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>f});var s={};t.r(s),t.d(s,{POST:()=>m,dynamic:()=>x});var n=t(62137),i=t(63654),a=t(48093),o=t(63e3),u=t(96330),p=t(29383),d=t(77136),c=t.n(d);let l=new u.PrismaClient,x="force-dynamic";async function m(e){try{let r=function(e){let r=(e.headers.get("cookie")||"").split(";").map(e=>e.trim()).find(e=>e.startsWith("token="));return r?r.split("=")[1]:null}(e),t=process.env.JWT_SECRET||"dev-secret";if(!r)return o.NextResponse.json({error:"Unauthorized"},{status:401});let s=null;try{s=c().verify(r,t)}catch(e){return o.NextResponse.json({error:"Unauthorized"},{status:401})}if("admin"!==s.role)return o.NextResponse.json({error:"Forbidden"},{status:403});let{email:n,newPassword:i}=await e.json()||{};if(!n||!i)return o.NextResponse.json({error:"Email and newPassword required"},{status:400});let a=await l.user.findUnique({where:{email:n}});if(!a)try{a=await l.user.findFirst({where:{email:{equals:n,mode:"insensitive"}}})}catch(e){}if(!a)return o.NextResponse.json({error:"User not found"},{status:404});let u=await p.Ay.hash(String(i),12);return await l.$executeRawUnsafe('UPDATE "User" SET password = $1 WHERE id = $2',u,a.id),o.NextResponse.json({ok:!0})}catch(e){return console.error(e),o.NextResponse.json({error:"Server error"},{status:500})}}let w=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/password-reset/admin/route",pathname:"/api/auth/password-reset/admin",filename:"route",bundlePath:"app/api/auth/password-reset/admin/route"},resolvedPagePath:"/home/lod/Downloads/jwrc/app/api/auth/password-reset/admin/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:f,serverHooks:v}=w;function j(){return(0,a.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:f})}},62290:()=>{},51674:()=>{}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5089,9862,7136,9383],()=>t(99333));module.exports=s})();