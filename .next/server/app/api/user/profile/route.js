(()=>{var e={};e.id=397,e.ids=[397],e.modules={96330:e=>{"use strict";e.exports=require("@prisma/client")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},79428:e=>{"use strict";e.exports=require("buffer")},55511:e=>{"use strict";e.exports=require("crypto")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},54937:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>R,routeModule:()=>g,serverHooks:()=>w,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>v});var i={};t.r(i),t.d(i,{GET:()=>x,PATCH:()=>h,dynamic:()=>f});var s=t(62137),n=t(63654),o=t(48093),a=t(63e3),u=t(96330),l=t(77136),p=t.n(l);let d=new u.PrismaClient;function c(e){return e?{id:e.id,name:e.name||"",email:e.email,role:e.role,phone:e.phone||"",location:e.location||"",bio:e.bio||"",profileImage:e.profileImage||"",isVolunteer:!!e.isVolunteer,createdAt:e.createdAt}:null}async function m(e){let r=function(e){let r=e.headers.get("authorization")||e.headers.get("Authorization");if(r&&r.startsWith("Bearer "))return r.substring(7);let t=(e.headers.get("cookie")||"").split(";").map(e=>e.trim()).find(e=>e.startsWith("token="));return t?t.split("=")[1]:null}(e);if(!r)return null;let t=process.env.JWT_SECRET||"dev-secret";try{let e=p().verify(r,t),i=await d.user.findUnique({where:{id:e.userId}});return i?{db:i,payload:e}:null}catch(e){return null}}let f="force-dynamic";async function x(e){try{let r=await m(e);if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});return a.NextResponse.json({user:c(r.db)})}catch(e){return console.error(e),a.NextResponse.json({error:"Server error"},{status:500})}}async function h(e){try{let r=await m(e);if(!r)return a.NextResponse.json({error:"Unauthorized"},{status:401});let t=await e.json().catch(()=>({})),i={},{name:s,email:n,phone:o,location:u,bio:l,profileImage:f}=t||{};if("string"==typeof s&&(i.name=s.trim()),"string"==typeof n&&(i.email=n.trim().toLowerCase()),"string"==typeof o&&(i.phone=o.trim()),"string"==typeof u&&(i.location=u.trim()),"string"==typeof l&&(i.bio=l.trim()),"string"==typeof f&&(i.profileImage=f.trim()),0===Object.keys(i).length)return a.NextResponse.json({error:"No updates provided"},{status:400});if(i.email&&i.email!==r.db.email){let e=await d.user.findFirst({where:{email:{equals:i.email,mode:"insensitive"}}});if(e&&e.id!==r.db.id)return a.NextResponse.json({error:"Email already in use"},{status:409})}let x=await d.user.update({where:{id:r.db.id},data:i});if(i.email&&i.email!==r.db.email)try{await d.$executeRawUnsafe("UPDATE volunteer_applications SET email = $1 WHERE LOWER(email) = LOWER($2)",String(i.email),String(r.db.email))}catch(e){console.warn("Failed to sync volunteer applications email",e)}let h=process.env.JWT_SECRET||"dev-secret",g=p().sign({userId:x.id,role:x.role,email:x.email},h,{expiresIn:"7d"}),y=`token=${g}; HttpOnly; Path=/; Max-Age=604800; SameSite=Lax`;return a.NextResponse.json({user:c(x),token:g},{headers:{"Set-Cookie":y}})}catch(e){return console.error(e),a.NextResponse.json({error:"Server error"},{status:500})}}let g=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/user/profile/route",pathname:"/api/user/profile",filename:"route",bundlePath:"app/api/user/profile/route"},resolvedPagePath:"/home/lod/Downloads/jwrc/app/api/user/profile/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:y,workUnitAsyncStorage:v,serverHooks:w}=g;function R(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:v})}},62290:()=>{},51674:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[5089,9862,7136],()=>t(54937));module.exports=i})();